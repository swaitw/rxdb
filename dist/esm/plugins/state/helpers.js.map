{"version":3,"file":"helpers.js","names":["overwritable","newRxError","RX_STATE_SCHEMA_TITLE","RX_STATE_ID_LENGTH","RX_STATE_COLLECTION_SCHEMA","title","primaryKey","version","type","properties","id","maxLength","minLength","pattern","sId","ops","minItems","items","k","v","required","nextRxStateId","lastId","padStart","parsed","parseInt","next","nextString","toString","isValidWeakMapKey","key","isDevMode","WeakMap","set","err"],"sources":["../../../../src/plugins/state/helpers.ts"],"sourcesContent":["import { overwritable } from '../../overwritable.ts';\nimport { newRxError } from '../../rx-error.ts';\nimport type { DeepReadonly, RxJsonSchema } from '../../types';\nimport type { RxStateDocument } from './types';\n\nexport const RX_STATE_SCHEMA_TITLE = 'RxStateCollection';\nexport const RX_STATE_ID_LENGTH = 14;\nexport const RX_STATE_COLLECTION_SCHEMA: DeepReadonly<RxJsonSchema<RxStateDocument>> = {\n    title: RX_STATE_SCHEMA_TITLE,\n    primaryKey: 'id',\n    version: 0,\n    type: 'object',\n    properties: {\n        id: {\n            type: 'string',\n            /**\n             * We store numbers in string format like '0001'\n             * with a left-pad.\n             */\n            maxLength: RX_STATE_ID_LENGTH,\n            minLength: RX_STATE_ID_LENGTH,\n            pattern: '[0-9]+'\n        },\n        sId: {\n            type: 'string',\n            maxLength: 10,\n            minLength: 10\n        },\n        ops: {\n            type: 'array',\n            minItems: 1,\n            items: {\n                type: 'object',\n                properties: {\n                    k: {\n                        type: 'string'\n                    },\n                    v: {\n                        /**\n                         * Do not define a type for the value\n                         * because anything is allowed.\n                         */\n                    }\n                },\n                required: [\n                    'k',\n                    'v'\n                ]\n            }\n        }\n    },\n    required: [\n        'id',\n        'sId',\n        'ops'\n    ]\n} as const;\n\n\nexport function nextRxStateId(lastId?: string): string {\n    if (!lastId) {\n        return ''.padStart(RX_STATE_ID_LENGTH, '0');\n    }\n    const parsed = parseInt(lastId, 10);\n    const next = parsed + 1;\n    const nextString = next.toString();\n    return nextString.padStart(RX_STATE_ID_LENGTH, '0');\n}\n\n\n\n/**\n * Only non-primitives can be used as a key in WeakMap\n */\nexport function isValidWeakMapKey(key: any) {\n    // This method is slow and must only be used in dev-mode!\n    if (!overwritable.isDevMode()) {\n        throw newRxError('SNH');\n    }\n    try {\n        new WeakMap().set(key, {});\n        return true;\n    } catch (err) {\n        return false;\n    }\n}\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,uBAAuB;AACpD,SAASC,UAAU,QAAQ,mBAAmB;AAI9C,OAAO,IAAMC,qBAAqB,GAAG,mBAAmB;AACxD,OAAO,IAAMC,kBAAkB,GAAG,EAAE;AACpC,OAAO,IAAMC,0BAAuE,GAAG;EACnFC,KAAK,EAAEH,qBAAqB;EAC5BI,UAAU,EAAE,IAAI;EAChBC,OAAO,EAAE,CAAC;EACVC,IAAI,EAAE,QAAQ;EACdC,UAAU,EAAE;IACRC,EAAE,EAAE;MACAF,IAAI,EAAE,QAAQ;MACd;AACZ;AACA;AACA;MACYG,SAAS,EAAER,kBAAkB;MAC7BS,SAAS,EAAET,kBAAkB;MAC7BU,OAAO,EAAE;IACb,CAAC;IACDC,GAAG,EAAE;MACDN,IAAI,EAAE,QAAQ;MACdG,SAAS,EAAE,EAAE;MACbC,SAAS,EAAE;IACf,CAAC;IACDG,GAAG,EAAE;MACDP,IAAI,EAAE,OAAO;MACbQ,QAAQ,EAAE,CAAC;MACXC,KAAK,EAAE;QACHT,IAAI,EAAE,QAAQ;QACdC,UAAU,EAAE;UACRS,CAAC,EAAE;YACCV,IAAI,EAAE;UACV,CAAC;UACDW,CAAC,EAAE;YACC;AACxB;AACA;AACA;UAHwB;QAKR,CAAC;QACDC,QAAQ,EAAE,CACN,GAAG,EACH,GAAG;MAEX;IACJ;EACJ,CAAC;EACDA,QAAQ,EAAE,CACN,IAAI,EACJ,KAAK,EACL,KAAK;AAEb,CAAU;AAGV,OAAO,SAASC,aAAaA,CAACC,MAAe,EAAU;EACnD,IAAI,CAACA,MAAM,EAAE;IACT,OAAO,EAAE,CAACC,QAAQ,CAACpB,kBAAkB,EAAE,GAAG,CAAC;EAC/C;EACA,IAAMqB,MAAM,GAAGC,QAAQ,CAACH,MAAM,EAAE,EAAE,CAAC;EACnC,IAAMI,IAAI,GAAGF,MAAM,GAAG,CAAC;EACvB,IAAMG,UAAU,GAAGD,IAAI,CAACE,QAAQ,CAAC,CAAC;EAClC,OAAOD,UAAU,CAACJ,QAAQ,CAACpB,kBAAkB,EAAE,GAAG,CAAC;AACvD;;AAIA;AACA;AACA;AACA,OAAO,SAAS0B,iBAAiBA,CAACC,GAAQ,EAAE;EACxC;EACA,IAAI,CAAC9B,YAAY,CAAC+B,SAAS,CAAC,CAAC,EAAE;IAC3B,MAAM9B,UAAU,CAAC,KAAK,CAAC;EAC3B;EACA,IAAI;IACA,IAAI+B,OAAO,CAAC,CAAC,CAACC,GAAG,CAACH,GAAG,EAAE,CAAC,CAAC,CAAC;IAC1B,OAAO,IAAI;EACf,CAAC,CAAC,OAAOI,GAAG,EAAE;IACV,OAAO,KAAK;EAChB;AACJ","ignoreList":[]}