{"version":3,"file":"index.js","names":["ZSchema","wrappedValidateStorageFactory","ZSchemaClass","zSchema","getZSchema","strictMode","getValidator","schema","validator","obj","validate","docData","useValidator","errors","getLastErrors","formattedZSchemaErrors","map","title","description","message","path","wrappedValidateZSchemaStorage"],"sources":["../../../../src/plugins/validate-z-schema/index.ts"],"sourcesContent":["/**\n * this plugin validates documents before they can be inserted into the RxCollection.\n * It's using z-schema as jsonschema-validator\n * @link https://github.com/zaggino/z-schema\n */\nimport ZSchema from 'z-schema';\nimport type { RxJsonSchema } from '../../types/index.d.ts';\nimport { wrappedValidateStorageFactory } from '../../plugin-helpers.ts';\n\n\nexport const ZSchemaClass = ZSchema;\n\nlet zSchema: ZSchema;\n\nexport function getZSchema() {\n    if (!zSchema) {\n        zSchema = new ZSchema({\n            strictMode: false\n        });\n    }\n    return zSchema;\n}\n\nexport function getValidator(\n    schema: RxJsonSchema<any>\n) {\n    const validator = (obj: any) => {\n        getZSchema().validate(obj, schema);\n        return getZSchema();\n    };\n    return (docData: any) => {\n        const useValidator = validator(docData);\n        if ((useValidator as any) === true) {\n            return;\n        }\n        const errors: ZSchema.SchemaErrorDetail[] = (useValidator as any).getLastErrors();\n        if (errors) {\n            const formattedZSchemaErrors = (errors as any).map(({\n                title,\n                description,\n                message,\n                path\n            }: any) => ({\n                title,\n                description,\n                message,\n                path\n            }));\n            return formattedZSchemaErrors;\n        } else {\n            return [];\n        }\n    };\n}\n\nexport const wrappedValidateZSchemaStorage = wrappedValidateStorageFactory(\n    getValidator,\n    'z-schema'\n);\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAOA,OAAO,MAAM,UAAU;AAE9B,SAASC,6BAA6B,QAAQ,yBAAyB;AAGvE,OAAO,IAAMC,YAAY,GAAGF,OAAO;AAEnC,IAAIG,OAAgB;AAEpB,OAAO,SAASC,UAAUA,CAAA,EAAG;EACzB,IAAI,CAACD,OAAO,EAAE;IACVA,OAAO,GAAG,IAAIH,OAAO,CAAC;MAClBK,UAAU,EAAE;IAChB,CAAC,CAAC;EACN;EACA,OAAOF,OAAO;AAClB;AAEA,OAAO,SAASG,YAAYA,CACxBC,MAAyB,EAC3B;EACE,IAAMC,SAAS,GAAIC,GAAQ,IAAK;IAC5BL,UAAU,CAAC,CAAC,CAACM,QAAQ,CAACD,GAAG,EAAEF,MAAM,CAAC;IAClC,OAAOH,UAAU,CAAC,CAAC;EACvB,CAAC;EACD,OAAQO,OAAY,IAAK;IACrB,IAAMC,YAAY,GAAGJ,SAAS,CAACG,OAAO,CAAC;IACvC,IAAKC,YAAY,KAAa,IAAI,EAAE;MAChC;IACJ;IACA,IAAMC,MAAmC,GAAID,YAAY,CAASE,aAAa,CAAC,CAAC;IACjF,IAAID,MAAM,EAAE;MACR,IAAME,sBAAsB,GAAIF,MAAM,CAASG,GAAG,CAAC,CAAC;QAChDC,KAAK;QACLC,WAAW;QACXC,OAAO;QACPC;MACC,CAAC,MAAM;QACRH,KAAK;QACLC,WAAW;QACXC,OAAO;QACPC;MACJ,CAAC,CAAC,CAAC;MACH,OAAOL,sBAAsB;IACjC,CAAC,MAAM;MACH,OAAO,EAAE;IACb;EACJ,CAAC;AACL;AAEA,OAAO,IAAMM,6BAA6B,GAAGpB,6BAA6B,CACtEK,YAAY,EACZ,UACJ,CAAC","ignoreList":[]}